<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>GraphQL: An Interactive Jaunt</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Lora:ital,wght@0,400..700;1,400..700&display=swap"
              rel="stylesheet" />
        <!-- Chosen Palette: Warm Neutrals with Teal Accent -->
        <!-- Application Structure Plan: A single-page application with a fixed sidebar for navigation and a main, scrollable content area. This structure provides easy access to all sections of the tutorial while allowing for focused reading. Interactive "builder" modules for Queries and Mutations are included to transform passive learning into an active, hands-on experience, which is the most effective way to grasp how GraphQL works. The goal is to let the user "feel" how client-side requests shape the data response. -->
        <!-- Visualization & Content Choices: The report is text and code-heavy, so the focus is on interactive code demonstrations rather than data charts. For "Queries" and "Mutations", an interactive simulator (HTML form -> JS logic -> updated code blocks) is used to demonstrate the core concept of client-driven data shaping. For "REST vs GraphQL", a styled HTML table provides a clear, scannable comparison. For complex concepts like "Subscriptions", simple animated diagrams created with HTML/CSS/JS are used to explain the process flow more effectively than static text. All choices prioritize engagement and clarity for a technical tutorial, confirming NO SVG/Mermaid. -->
        <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
        <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #f8f7f6; /* A warm, very light grey */
        color: #44403c; /* stone-700 */
      }
      h1,
      h2,
      h3 {
        font-family: "Lora", serif;
        font-weight: 600;
      }
      .prose-custom {
        font-size: 1.1rem;
        line-height: 1.7;
      }
      .prose-custom p,
      .prose-custom ul,
      .prose-custom ol,
      .prose-custom table {
        margin-bottom: 1.5em;
      }
      .prose-custom h2 {
        margin-top: 2.5em;
        margin-bottom: 1em;
        padding-bottom: 0.3em;
        border-bottom: 1px solid #e7e5e4; /* stone-200 */
      }
      .prose-custom h3 {
        margin-top: 2em;
        margin-bottom: 0.8em;
      }
      .prose-custom code {
        background-color: #e7e5e4; /* stone-200 */
        color: #78716c; /* stone-500 */
        padding: 0.2em 0.4em;
        border-radius: 4px;
        font-size: 0.9em;
      }
      .prose-custom pre {
        background-color: #292524; /* stone-800 */
        color: #d6d3d1; /* stone-300 */
        padding: 1em;
        border-radius: 8px;
        overflow-x: auto;
        white-space: pre-wrap;
      }
      .prose-custom pre code {
        background-color: transparent;
        color: inherit;
        padding: 0;
      }
      .prose-custom strong {
        color: #292524; /* stone-800 */
        font-weight: 600;
      }
      .prose-custom blockquote {
        border-left: 3px solid #5eead4; /* teal-300 */
        padding-left: 1.5em;
        margin-left: 0;
        font-style: italic;
        color: #57534e; /* stone-600 */
      }
      .prose-custom a {
        color: #0d9488; /* teal-600 */
        text-decoration: none;
        font-weight: 500;
      }
      .prose-custom a:hover {
        text-decoration: underline;
      }
      .sidebar-link {
        transition: all 0.2s ease-in-out;
        border-left: 3px solid transparent;
      }
      .sidebar-link.active {
        color: #0d9488; /* teal-600 */
        border-left-color: #0d9488;
        transform: translateX(4px);
        font-weight: 600;
      }
      .card {
        background-color: white;
        border: 1px solid #e7e5e4;
        border-radius: 12px;
        box-shadow:
          0 4px 6px -1px rgb(0 0 0 / 0.05),
          0 2px 4px -2px rgb(0 0 0 / 0.05);
        transition:
          transform 0.2s ease-in-out,
          box-shadow 0.2s ease-in-out;
      }
      .card:hover {
        transform: translateY(-4px);
        box-shadow:
          0 10px 15px -3px rgb(0 0 0 / 0.07),
          0 4px 6px -4px rgb(0 0 0 / 0.07);
      }
      details > summary {
        cursor: pointer;
        font-weight: 500;
        padding: 0.5rem 1rem;
        background-color: #f5f5f4; /* stone-100 */
        border-radius: 6px;
        transition: background-color 0.2s;
      }
      details > summary:hover {
        background-color: #e7e5e4; /* stone-200 */
      }
      details[open] > summary {
        background-color: #e7e5e4;
      }
      .chart-container {
        position: relative;
        width: 100%;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
        height: 350px;
        max-height: 40vh;
      }

      /* Subscription Animation */
      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.6;
        }
      }
      @keyframes travel {
        to {
          transform: translateX(350px) scale(0.8);
          opacity: 0;
        }
      }
      @keyframes travel-back {
        to {
          transform: translateX(-350px) scale(0.8);
          opacity: 0;
        }
      }
      .subscription-animation-dot {
        position: absolute;
        width: 20px;
        height: 20px;
        background: #2dd4bf; /* teal-400 */
        border-radius: 50%;
        display: none;
      }
        </style>
    </head>
    <body class="bg-stone-100">
        <div class="flex min-h-screen">
            <!-- Sidebar Navigation -->
            <aside class="w-64 fixed top-0 left-0 h-full bg-white border-r border-stone-200 p-8 hidden lg:block">
                <h1 class="text-xl font-bold text-stone-800 mb-8 font-lora">GraphQL: An Interactive Jaunt</h1>
                <nav id="sidebar-nav" class="space-y-3">
                    <a href="#intro"
                       class="block sidebar-link p-2 pl-4 text-stone-600 hover:text-teal-600">What's This Malarkey?</a>
                    <a href="#schemas"
                       class="block sidebar-link p-2 pl-4 text-stone-600 hover:text-teal-600">Schemas & Types</a>
                    <a href="#queries"
                       class="block sidebar-link p-2 pl-4 text-stone-600 hover:text-teal-600">Mastering Queries</a>
                    <a href="#mutations"
                       class="block sidebar-link p-2 pl-4 text-stone-600 hover:text-teal-600">Stirring Things Up</a>
                    <a href="#subscriptions"
                       class="block sidebar-link p-2 pl-4 text-stone-600 hover:text-teal-600">Real-Time Updates</a>
                    <a href="#comparison"
                       class="block sidebar-link p-2 pl-4 text-stone-600 hover:text-teal-600">GraphQL vs. REST</a>
                    <a href="#security"
                       class="block sidebar-link p-2 pl-4 text-stone-600 hover:text-teal-600">A Word on Security</a>
                    <a href="#farewell"
                       class="block sidebar-link p-2 pl-4 text-stone-600 hover:text-teal-600">The Farewell</a>
                </nav>
            </aside>
            <!-- Main Content -->
            <main class="lg:ml-64 flex-1 p-4 sm:p-8 md:p-12">
                <div class="max-w-4xl mx-auto prose-custom">
                    <section id="intro">
                        <h1 class="text-4xl md:text-5xl text-stone-800">GraphQL: A Reasonably Thorough Jaunt</h1>
                        <p class="text-lg text-stone-600">
                            Right then. You're a clever sort, but GraphQL has thus far remained a mysterious acronym. Fear not. We're
                            aiming for enlightenment with a side of dry wit, and examples that might raise an eyebrow.
                        </p>
                        <h2>So, What's All This GraphQL Malarkey Then?</h2>
                        <p>
                            The tech world loves to throw new toys out of the pram. GraphQL, conceived at Facebook, is a different way
                            for your whizzy front-end applications to have a chinwag with the servers at the back. Before we dive in,
                            let's have a brief, grumbling look at what came before: REST.
                        </p>
                        <h3>The Pains of REST</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 my-8">
                            <div class="card p-6">
                                <h4 class="font-bold text-lg mb-2 text-rose-600">Over-fetching</h4>
                                <p>
                                    The "I asked for a teaspoon, you gave me the entire cutlery drawer" problem. REST endpoints often
                                    return far more data than you need, wasting bandwidth.
                                </p>
                            </div>
                            <div class="card p-6">
                                <h4 class="font-bold text-lg mb-2 text-amber-600">Under-fetching</h4>
                                <p>
                                    The "death by a thousand API calls" problem. A single endpoint doesn't give you enough, forcing you to
                                    make multiple requests to build one view (the N+1 problem).
                                </p>
                            </div>
                            <div class="card p-6">
                                <h4 class="font-bold text-lg mb-2 text-sky-600">Endpoint Sprawl</h4>
                                <p>
                                    The "which of these 74 doors do I knock on?" problem. REST APIs can have a bewildering number of
                                    endpoints, making them hard to navigate and manage.
                                </p>
                            </div>
                            <div class="card p-6">
                                <h4 class="font-bold text-lg mb-2 text-indigo-600">Versioning Headaches</h4>
                                <p>
                                    The "is it `/v1`, `/v2`, or `/v2_final_for_real`?" problem. Evolving REST APIs often means maintaining
                                    multiple, clunky versions.
                                </p>
                            </div>
                        </div>
                        <h3>Enter GraphQL</h3>
                        <blockquote>
                            GraphQL's core idea is deceptively simple: instead of the server dictating what data you get from an
                            endpoint, the <strong>client</strong> asks for exactly the data it needs, and gets precisely that – no
                            more, no less.
                        </blockquote>
                        <p>
                            It's a query language for your API that typically operates over a single endpoint. This shift in control
                            from server to client is the key to solving the RESTful woes we just grumbled about.
                        </p>
                    </section>
                    <section id="schemas">
                        <h2>The Blueprint of Your Data Dreams – Schemas and Types</h2>
                        <p>
                            GraphQL isn't psychic. It relies on a <strong>Schema</strong> – the API's constitution, its meticulously
                            drafted rulebook. It's a formal description of all available data, written in the human-readable GraphQL
                            Schema Definition Language (SDL). This schema is the contract between client and server.
                        </p>
                        <details class="my-4">
                            <summary>Example: The Lost Umbrella Schema</summary>
                            <div class="p-4 border border-t-0 border-stone-200 rounded-b-lg">
                                <pre><code class="language-graphql"># A type for a particularly British predicament
type LostUmbrella {
  id: ID! # '!' means non-nullable, like the rain in Manchester
  lastSeenLocation: String
  colour: String!
  isProbablyInAPubSomewhere: Boolean
}

# This is how we'll ask for lost umbrellas
type Query {
  allLostUmbrellas: [LostUmbrella]
  findMyUmbrella(colour: String): LostUmbrella
}</code></pre>
                            </div>
                        </details>
                        <h3>Types, Glorious Types!</h3>
                        <p>
                            GraphQL is <strong>strongly typed</strong>, which drastically reduces errors. Every piece of data has a
                            specific type. The main categories are:
                        </p>
                        <ul class="list-disc pl-5 space-y-2">
                            <li>
                                <strong>Scalar Types:</strong> The basics: <code>Int</code>, <code>Float</code>, <code>String</code>,
                                <code>Boolean</code>, and <code>ID</code>.
                            </li>
                            <li>
                                <strong>Object Types:</strong> Custom types you define, like our <code>LostUmbrella</code>.
                            </li>
                            <li>
                                <strong>Query & Mutation Types:</strong> Special root types for reading (Query) or changing (Mutation)
                                data.
                            </li>
                            <li>
                                <strong>Enums, Lists, and Non-Null:</strong> For defining a set of allowed values, lists of a type
                                (e.g., <code>[LostUmbrella]</code>), and fields that are guaranteed to have a value (e.g.,
                                <code>String!</code>).
                            </li>
                        </ul>
                    </section>
                    <section id="queries">
                        <h2>"Can I Just Have the Biscuits, Please?" – Mastering Queries</h2>
                        <p>
                            Queries are how you ask for data. The cornerstone is simple: you specify the fields you want, and only
                            those fields are returned. No more, no less. Let's make this interactive.
                        </p>
                        <h3>Interactive Query Builder</h3>
                        <p>
                            Imagine we're querying our "National Register of Queuing Grievances". Use the checkboxes below to build
                            your query and see the JSON response change instantly. This demonstrates the power of asking for exactly
                            what you need.
                        </p>
                        <div class="card p-6 my-8">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h4 class="font-bold text-lg mb-4">Select Fields for `QueuingGrievance`:</h4>
                                    <form id="query-builder" class="space-y-3">
                                        <label class="flex items-center space-x-3">
                                            <input type="checkbox"
                                                   class="h-5 w-5 rounded border-gray-300 text-teal-600 focus:ring-teal-500"
                                                   name="id"
                                                   checked />
                                            <span>id</span>
                                        </label>
                                        <label class="flex items-center space-x-3">
                                            <input type="checkbox"
                                                   class="h-5 w-5 rounded border-gray-300 text-teal-600 focus:ring-teal-500"
                                                   name="description"
                                                   checked />
                                            <span>description</span>
                                        </label>
                                        <label class="flex items-center space-x-3">
                                            <input type="checkbox"
                                                   class="h-5 w-5 rounded border-gray-300 text-teal-600 focus:ring-teal-500"
                                                   name="severity" />
                                            <span>severity</span>
                                        </label>
                                        <label class="flex items-center space-x-3">
                                            <input type="checkbox"
                                                   class="h-5 w-5 rounded border-gray-300 text-teal-600 focus:ring-teal-500"
                                                   name="reportedAt" />
                                            <span>reportedAt</span>
                                        </label>
                                        <label class="flex items-center space-x-3">
                                            <input type="checkbox"
                                                   class="h-5 w-5 rounded border-gray-300 text-teal-600 focus:ring-teal-500"
                                                   name="location" />
                                            <span>location { name }</span>
                                        </label>
                                    </form>
                                </div>
                                <div>
                                    <h4 class="font-bold text-lg mb-2">Your GraphQL Query:</h4>
                                    <pre><code id="query-output"></code></pre>
                                    <h4 class="font-bold text-lg mt-4 mb-2">Simulated JSON Response:</h4>
                                    <pre><code id="response-output"></code></pre>
                                </div>
                            </div>
                        </div>
                        <h3>Arguments, Aliases, and Fragments</h3>
                        <p>GraphQL queries can be made more powerful with:</p>
                        <ul class="list-disc pl-5 space-y-2">
                            <li>
                                <strong>Arguments:</strong> To filter or specify parameters, e.g., <code>grievance(id: "123")</code>.
                            </li>
                            <li>
                                <strong>Aliases:</strong> To rename fields in your results, e.g.,
                                <code>severeGrievances: grievances(severity: "HIGH")</code>.
                            </li>
                            <li>
                                <strong>Fragments:</strong> To create reusable sets of fields for different parts of your query.
                            </li>
                            <li>
                                <strong>Variables:</strong> To pass dynamic values into queries instead of hardcoding them.
                            </li>
                        </ul>
                    </section>
                    <section id="mutations">
                        <h2>"Right, Let's Stir Things Up" – Mutations</h2>
                        <p>
                            When you want to change data, you use a <strong>Mutation</strong>. They handle Create, Update, and Delete
                            operations. One of the best parts is that you can ask for the new state of the data back in the same
                            request.
                        </p>
                        <h3>Interactive Mutation Simulator</h3>
                        <p>
                            Let's report a new queuing grievance. Fill out the form below to see how a mutation is constructed and
                            what data it can return.
                        </p>
                        <div class="card p-6 my-8">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h4 class="font-bold text-lg mb-4">Report a New Grievance:</h4>
                                    <form id="mutation-builder" class="space-y-4">
                                        <div>
                                            <label for="grievance-desc" class="block text-sm font-medium text-stone-700">Description</label>
                                            <input type="text"
                                                   id="grievance-desc"
                                                   value="Person ahead paid for a single stamp with a £50 note."
                                                   class="mt-1 block w-full rounded-md border-stone-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 sm:text-sm" />
                                        </div>
                                        <div>
                                            <label for="grievance-severity"
                                                   class="block text-sm font-medium text-stone-700">Severity</label>
                                            <select id="grievance-severity"
                                                    class="mt-1 block w-full rounded-md border-stone-300 py-2 pl-3 pr-10 text-base focus:border-teal-500 focus:outline-none focus:ring-teal-500 sm:text-sm">
                                                <option>MILD_TUTTING</option>
                                                <option selected>AUDIBLE_SIGH</option>
                                                <option>MUTTERING_UNDER_BREATH</option>
                                                <option>ACTUAL_CONFRONTATION</option>
                                            </select>
                                        </div>
                                    </form>
                                </div>
                                <div>
                                    <h4 class="font-bold text-lg mb-2">Your GraphQL Mutation:</h4>
                                    <pre><code id="mutation-output"></code></pre>
                                    <h4 class="font-bold text-lg mt-4 mb-2">Simulated Response Payload:</h4>
                                    <pre><code id="mutation-response-output"></code></pre>
                                </div>
                            </div>
                        </div>
                    </section>
                    <section id="subscriptions">
                        <h2>"Is the Kettle Boiling Yet?" – Subscriptions</h2>
                        <p>
                            For real-time updates, GraphQL offers <strong>Subscriptions</strong>. Instead of repeatedly asking the
                            server if anything has changed (polling), you open a persistent connection (usually a WebSocket) and the
                            server pushes updates to you when specific events happen.
                        </p>
                        <h3>How Subscriptions Work</h3>
                        <p>
                            It's like a very efficient town crier. A client subscribes, a mutation triggers an event, a Pub/Sub system
                            broadcasts it, and the server pushes the new data down the WebSocket to the subscribed client. Click below
                            to see a simplified visual representation.
                        </p>
                        <div class="card p-6 my-8">
                            <div class="relative h-48 flex items-center justify-around text-center">
                                <div class="z-10">
                                    <p class="font-bold">Client</p>
                                    <div class="w-16 h-16 bg-sky-200 rounded-full mx-auto"></div>
                                </div>
                                <div class="z-10">
                                    <p class="font-bold">GraphQL Server</p>
                                    <div class="w-16 h-16 bg-rose-200 rounded-full mx-auto"></div>
                                </div>
                                <div class="z-10">
                                    <p class="font-bold">Database/Event</p>
                                    <div class="w-16 h-16 bg-amber-200 rounded-full mx-auto"></div>
                                </div>
                                <div id="sub-dot-1"
                                     class="subscription-animation-dot"
                                     style="left: 60px;
                                            top: 70px"></div>
                                <div id="sub-dot-2"
                                     class="subscription-animation-dot"
                                     style="right: 60px;
                                            top: 70px"></div>
                            </div>
                            <button id="run-animation-btn"
                                    class="mt-4 w-full bg-teal-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-teal-700 transition">
                                Run Animation
                            </button>
                        </div>
                    </section>
                    <section id="comparison">
                        <h2>GraphQL vs. REST: A Barbed Comparison</h2>
                        <p>
                            Let's put them side-by-side, like two contestants in a village bake-off. One is a reliable Victoria sponge
                            (REST), the other a fancy, deconstructed pavlova (GraphQL).
                        </p>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-stone-200 border border-stone-200 rounded-lg">
                                <thead class="bg-stone-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-bold text-stone-600 uppercase tracking-wider">Feature</th>
                                        <th class="px-6 py-3 text-left text-xs font-bold text-stone-600 uppercase tracking-wider">GraphQL Approach</th>
                                        <th class="px-6 py-3 text-left text-xs font-bold text-stone-600 uppercase tracking-wider">REST Approach</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-stone-200">
                                    <tr>
                                        <td class="px-6 py-4 font-bold">Data Fetching</td>
                                        <td class="px-6 py-4">Ask for exactly what you need. (Bespoke suit)</td>
                                        <td class="px-6 py-4">Get a fixed menu. (Off-the-peg)</td>
                                    </tr>
                                    <tr>
                                        <td class="px-6 py-4 font-bold">Endpoints</td>
                                        <td class="px-6 py-4">Typically one magical door for everything.</td>
                                        <td class="px-6 py-4">A different door for every room.</td>
                                    </tr>
                                    <tr>
                                        <td class="px-6 py-4 font-bold">Error Handling</td>
                                        <td class="px-6 py-4">A `200 OK` with an `errors` array. (Polite, itemised note)</td>
                                        <td class="px-6 py-4">HTTP status codes (404, 500 etc). (Slammed door)</td>
                                    </tr>
                                    <tr>
                                        <td class="px-6 py-4 font-bold">Caching</td>
                                        <td class="px-6 py-4">More complex, often client-side. (Craft ale)</td>
                                        <td class="px-6 py-4">Simple HTTP caching. (Pint at the local)</td>
                                    </tr>
                                    <tr>
                                        <td class="px-6 py-4 font-bold">Versioning</td>
                                        <td class="px-6 py-4">Evolve by adding fields, no `/v2` needed.</td>
                                        <td class="px-6 py-4">Painful `/v1`, `/v2` paths are common.</td>
                                    </tr>
                                    <tr>
                                        <td class="px-6 py-4 font-bold">Schema/Typing</td>
                                        <td class="px-6 py-4">Strongly typed via a mandatory schema.</td>
                                        <td class="px-6 py-4">No built-in schema; relies on docs.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </section>
                    <section id="security">
                        <h2>A Fleeting, Mildly Terrifying Mention of Security</h2>
                        <p>
                            With great power comes great responsibility. GraphQL's flexibility means you need to be thoughtful about
                            security.
                        </p>
                        <div class="space-y-4">
                            <details class="card">
                                <summary class="font-bold">Authorization</summary>
                                <div class="p-6 border-t border-stone-200">
                                    Just because a client can ask for a field doesn't mean they should get it. You must implement checks
                                    to ensure users only see data they're permitted to see.
                                </div>
                            </details>
                            <details class="card">
                                <summary class="font-bold">Query Complexity & Depth Limiting</summary>
                                <div class="p-6 border-t border-stone-200">
                                    Prevent malicious queries from melting your server by setting limits on how deep or complex a query
                                    can be.
                                </div>
                            </details>
                            <details class="card">
                                <summary class="font-bold">Input Validation</summary>
                                <div class="p-6 border-t border-stone-200">
                                    The eternal rule: never trust user input. Validate and sanitize everything, always.
                                </div>
                            </details>
                        </div>
                    </section>
                    <section id="farewell">
                        <h2>So, Are We Done Here?</h2>
                        <blockquote>
                            So there you have it. GraphQL. Not so terrifying after all, eh? More like a slightly eccentric but
                            surprisingly capable new colleague who, once you get to know their ways, actually makes your life a bit
                            easier.
                        </blockquote>
                        <p>
                            Now, if you'll excuse me, all this talk of APIs, schemas, and the existential dread of an empty biscuit
                            tin has made me rather thirsty. Time for a cuppa. Milk in last, obviously. Or is it?
                        </p>
                    </section>
                </div>
            </main>
        </div>
        <script>
      document.addEventListener("DOMContentLoaded", () => {
        // --- Interactive Query Builder ---
        const queryBuilderForm = document.getElementById("query-builder");
        const queryOutput = document.getElementById("query-output");
        const responseOutput = document.getElementById("response-output");

        const grievanceData = {
          id: '"grief-abc-123"',
          description: '"Person ahead attempting to pay for a single stamp with a £50 note."',
          severity: '"MILD_TUTTING"',
          reportedAt: '"2025-06-07T09:30:00Z"',
          location: {
            name: '"Post Office, Upper Backwash"',
          },
        };

        function updateQuery() {
          const selectedFields = Array.from(queryBuilderForm.elements)
            .filter((el) => el.type === "checkbox" && el.checked)
            .map((el) => el.name);

          if (selectedFields.length === 0) {
            queryOutput.textContent =
              "query GetGrievances {\n  allGrievances {\n    # Please select at least one field\n  }\n}";
            responseOutput.textContent =
              '{\n  "data": null,\n  "errors": [\n    {\n      "message": "Validation error: Must have a selection of subfields."\n    }\n  ]\n}';
            return;
          }

          const fieldsString = selectedFields
            .map((field) => {
              if (field === "location") return "    location {\n      name\n    }";
              return `    ${field}`;
            })
            .join("\n");

          queryOutput.textContent = `query GetGrievances {\n  allGrievances {\n${fieldsString}\n  }\n}`;

          const responseData = { allGrievances: [{}] };
          selectedFields.forEach((field) => {
            if (field === "location") {
              responseData.allGrievances[0].location = { name: grievanceData.location.name };
            } else {
              responseData.allGrievances[0][field] = grievanceData[field];
            }
          });

          responseOutput.textContent = JSON.stringify({ data: responseData }, null, 2);
        }
        queryBuilderForm.addEventListener("change", updateQuery);
        updateQuery();

        // --- Interactive Mutation Builder ---
        const mutationBuilderForm = document.getElementById("mutation-builder");
        const mutationOutput = document.getElementById("mutation-output");
        const mutationResponseOutput = document.getElementById("mutation-response-output");

        function updateMutation() {
          const description = document.getElementById("grievance-desc").value;
          const severity = document.getElementById("grievance-severity").value;

          const mutationString = `mutation ReportNewGrievance {
  reportGrievance(input: {
    description: "${description.replace(/"/g, '\\"')}"
    severity: ${severity}
  }) {
    id
    description
    severity
    reportedAt
  }
}`;
          mutationOutput.textContent = mutationString;

          const responseData = {
            reportGrievance: {
              id: `"grief-${Math.random().toString(36).substr(2, 9)}"`,
              description: `"${description}"`,
              severity: `"${severity}"`,
              reportedAt: `"${new Date().toISOString()}"`,
            },
          };
          mutationResponseOutput.textContent = JSON.stringify({ data: responseData }, null, 2);
        }
        mutationBuilderForm.addEventListener("input", updateMutation);
        updateMutation();

        // --- Sidebar Active State on Scroll ---
        const sections = document.querySelectorAll("main section");
        const navLinks = document.querySelectorAll("#sidebar-nav a");

        const observer = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              if (entry.isIntersecting) {
                navLinks.forEach((link) => {
                  link.classList.remove("active");
                  if (link.getAttribute("href").substring(1) === entry.target.id) {
                    link.classList.add("active");
                  }
                });
              }
            });
          },
          { rootMargin: "-30% 0px -70% 0px", threshold: 0 },
        );

        sections.forEach((section) => observer.observe(section));

        // --- Subscription Animation ---
        const runAnimationBtn = document.getElementById("run-animation-btn");
        const dot1 = document.getElementById("sub-dot-1");
        const dot2 = document.getElementById("sub-dot-2");

        runAnimationBtn.addEventListener("click", () => {
          runAnimationBtn.disabled = true;
          runAnimationBtn.textContent = "Animating...";

          // Reset
          dot1.style.display = "none";
          dot2.style.display = "none";
          dot1.style.animation = "none";
          dot2.style.animation = "none";

          setTimeout(() => {
            // 1. Client sends subscription request
            dot1.style.transform = "translateX(0)";
            dot1.style.opacity = "1";
            dot1.style.display = "block";
            dot1.style.animation = "travel 1.5s ease-in-out forwards";
          }, 100);

          setTimeout(() => {
            // 2. Mutation happens, server publishes event
            dot2.style.transform = "translateX(0)";
            dot2.style.opacity = "1";
            dot2.style.display = "block";
            dot2.style.animation = "pulse 1s ease-in-out";
          }, 1600);

          setTimeout(() => {
            // 3. Server pushes update to client
            dot1.style.transform = "translateX(0)";
            dot1.style.opacity = "1";
            dot1.style.display = "block";
            dot1.style.animation = "travel-back 1.5s ease-in-out forwards";
          }, 2700);

          setTimeout(() => {
            runAnimationBtn.disabled = false;
            runAnimationBtn.textContent = "Run Animation Again";
          }, 4300);
        });
      });
        </script>
    </body>
</html>
